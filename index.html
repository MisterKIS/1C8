<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Данные из Google Sheets</title>
 <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
     button {
    margin: 5px;           /* Отступ 5px со всех сторон у каждой кнопки */
    padding: 10px 20px;    /* Внутренние отступы: 10px сверху/снизу, 20px слева/справа */
    background: #4285f4;   /* Синий цвет фона (Google blue) */
    color: white;          /* Белый цвет текста */
    border: none;          /* Убрать стандартную рамку кнопки */
    border-radius: 4px;    /* Скруглить углы на 4px */
    cursor: pointer;       /* Изменить курсор на "руку" при наведении */
    font-size: 14px;       /* Размер шрифта */
    transition: background 0.3s; /* Плавное изменение фона за 0.3 секунды */
}
    </style>
</head>
<html>
  <head>
    <base target="_top">
  </head>
  <body>
    <!-- Кнопка для загрузки -->
    <button onclick="loadData('oll')">Загрузить остатки</button>
    <button onclick="loadData('balance')">Загрузить расходы</button>
    <div id="data"></div>
    <script>
      
      async function loadData(sheetName = 'oll') {
        const container = document.getElementById('data');
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbxz8mczromb-Fa6Iq2jK9Ezm2tUYsDR2waJaUdelnturU0JNCTh4p4F_T1KPgKuvo9v/exec';
  // Добавляем параметр sheet в URL
  const urlWithParams = `${scriptUrl}?sheet=${encodeURIComponent(sheetName)}`;
        
      const response = await fetch(urlWithParams);
        const data = await response.json();  // Парсим JSON
    
        console.log('Данные из листа', sheetName, ':', data);
        //console.log('Значения:', data.values);
        if (sheetName === 'balance') {
        // Получаем последние 5 строк
  const lastFiveRows = data.values.slice(-5);
          // Отображаем данные
  displayData(lastFiveRows);
          return;
        }
        const result = getColumn(data, ["Паритет", "Альфа", "Наличные"]);
        // Создаем таблицу
        displayData(result.rows);
        return;
            let html = '<table>';
            
            // Добавляем заголовки (первая строка)
            
            html += '<tr>';
            result.headers.forEach(column => {
                html += `<th>${column}</th>`;
            });
            html += '</tr>';
        

        html += '<tbody>';
        result.rows.forEach(row => {
          html += '<tr>';
          row.forEach(cell => {
            html += `<td>${cell || ''}</td>`;
        });
        html += '</tr>';
        });
        html += '</tbody></table>';
            container.innerHTML = html;
}
      
function displayData(rows) {
  const container = document.getElementById('data');
  
  if (rows.length === 0) {
    container.innerHTML = '<p>Нет данных для отображения</p>';
    return;
  }
  
  // Создаем таблицу
  let html = '<table border="1" style="border-collapse: collapse; width: 100%;">';
  
  // Заголовок таблицы (первая строка массива)
  html += '<thead><tr>';
  rows[0].forEach(cell => {
    html += `<th style="padding: 8px; background: #f2f2f2;">${cell}</th>`;
  });
  html += '</tr></thead>';
  
  // Тело таблицы (последние 5 строк, начиная со второй)
  html += '<tbody>';
  rows.slice(1, 6).forEach(row => { // slice(1, 6) берет строки с 1 по 5 индекс
    html += '<tr>';
    row.forEach(cell => {
      html += `<td style="padding: 8px;">${cell || ''}</td>`;
    });
    html += '</tr>';
  });
  html += '</tbody></table>';
  
  container.innerHTML = html;
}
      function getLastFiveRows(data) {
  // Проверяем структуру данных Google Sheets API
  if (data.values && Array.isArray(data.values)) {
    // data.values - это массив строк
    return data.values.slice(-5);
  } else if (Array.isArray(data)) {
    // Если данные пришли как простой массив
    return data.slice(-5);
  }

}   
     
   function getColumn(data, colname) {
     const headers = data.values[0];
     const rows = data.values;
    const lastRowIndex = rows.length - 1;
//console.log('данные:',rows);
      const columnIndices = colname.map(name => 
        headers.indexOf(name)
    ).filter(index => index !== -1); // Убираем не найденные

     const filteredHeaders = headers.filter((_, index) => 
        columnIndices.includes(index)
    );

     // Получаем только последнюю строку и фильтруем её
const lastRow = rows[lastRowIndex];
const filteredLastRow = columnIndices.map(index => lastRow[index]);
     return {
        headers: filteredHeaders,
        rows: [filteredLastRow],
        fullData: [filteredHeaders, filteredLastRow]
    };
   }
    </script>
  </body>
</html>
